adminPassword: "admin-secret"

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
    - name: Prometheus
      type: prometheus
      url: http://prometheus-server.monitoring.svc:80
      access: proxy
      isDefault: true
      editable: true

dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
    - name: default
      orgId: 1
      folder: ''
      type: file
      disableDeletion: false
      editable: true
      options:
        path: /var/lib/grafana/dashboards/default

dashboards:
  default:
    hubble-metrics:
      gnetId: null
      datasource: Prometheus
      json: |
        {
          "annotations": {
            "list": [
              {
                "builtIn": 1,
                "datasource": {
                  "type": "grafana",
                  "uid": "-- Grafana --"
                },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
              }
            ]
          },
          "editable": true,
          "fiscalYearStartMonth": 0,
          "graphTooltip": 0,
          "id": 2,
          "links": [],
          "panels": [
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Flows/s",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 13,
                "w": 12,
                "x": 0,
                "y": 0
              },
              "id": 1,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "expr": "sum(rate(hubble_flows_processed_total{destination_workload=~\"backend|celery-coordinator|data-extractor|ocr-worker|postgres|redis\",destination_namespace=\"default\"}[30s])) by (destination_namespace, destination_workload)",
                  "legendFormat": "{{destination_workload}}",
                  "refId": "A"
                }
              ],
              "title": "Hubble Flows per Workload (default)",
              "type": "timeseries"
            },
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Flows/s/pod",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 13,
                "w": 12,
                "x": 12,
                "y": 0
              },
              "id": 2,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "expr": "sum(rate(hubble_flows_processed_total{destination_workload=~\"backend|celery-coordinator|data-extractor|ocr-worker|postgres|redis\",destination_namespace=\"default\"}[30s])) by (destination_workload) / (count by (destination_workload) (label_replace(kube_pod_owner{owner_kind=~\"(ReplicaSet|StatefulSet)\", namespace=\"default\"},\"destination_workload\", \"$1\", \"owner_name\", \"^(.*)-[a-z0-9]+$\")) or vector(1))",
                  "legendFormat": "{{destination_workload}}",
                  "refId": "A"
                }
              ],
              "title": "Hubble Flows per Pod (default)",
              "type": "timeseries"
            },
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Seconds",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "s"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 14,
                "w": 12,
                "x": 0,
                "y": 13
              },
              "id": 3,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "histogram_quantile(\n  0.95,\n  sum by (le, destination_workload) (\n    label_replace(\n      rate(hubble_http_request_duration_seconds_bucket{destination_namespace=\"default\"}[30s]),\n      \"destination_workload\",\n      \"backend\",\n      \"destination_workload\",\n      \"^$\"\n    )\n  )\n)\n",
                  "legendFormat": "{{destination_workload}}",
                  "range": true,
                  "refId": "A"
                }
              ],
              "title": "Hubble HTTP Request Latency (P95, default)",
              "type": "timeseries"
            },
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Ratio",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "max": 1,
                  "min": 0,
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "percentunit"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 14,
                "w": 12,
                "x": 12,
                "y": 13
              },
              "id": 5,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "expr": "sum(rate(hubble_http_requests_total{status=~\"5..\",destination_namespace=\"default\"}[30s])) by (destination_workload) > 0 or vector(0)  / (sum(rate(hubble_http_requests_total{destination_namespace=\"default\"}[30s])) by (destination_workload) > 0 or vector(1))",
                  "legendFormat": "{{destination_workload}}",
                  "refId": "A"
                }
              ],
              "title": "Hubble HTTP 5xx Response Ratio (default)",
              "type": "timeseries"
            },
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Seconds",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "s"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 14,
                "w": 12,
                "x": 0,
                "y": 27
              },
              "id": 4,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "sum by (destination_workload) (\n  label_replace(\n    rate(hubble_http_request_duration_seconds_sum{destination_namespace=\"default\"}[30s]),\n    \"destination_workload\", \n    \"backend\", \n    \"destination_workload\", \n    \"^$\"\n  )\n) \n/ \nsum by (destination_workload) (\n  label_replace(\n    rate(hubble_http_request_duration_seconds_count{destination_namespace=\"default\"}[30s]),\n    \"destination_workload\", \n    \"backend\", \n    \"destination_workload\", \n    \"^$\"\n  )\n)\n",
                  "legendFormat": "{{destination_workload}}",
                  "range": true,
                  "refId": "A"
                }
              ],
              "title": "Hubble HTTP Request Latency Average",
              "type": "timeseries"
            }
          ],
          "preload": false,
          "refresh": "",
          "schemaVersion": 41,
          "tags": [
            "network",
            "hubble"
          ],
          "templating": {
            "list": [
              {
                "current": {
                  "text": "All",
                  "value": "$__all"
                },
                "datasource": "Prometheus",
                "definition": "label_values(hubble_flows_processed_total{destination_namespace=\"default\",destination_workload=~\"backend|celery-coordinator|data-extractor|ocr-worker|postgres|redis\"}, destination_workload)",
                "includeAll": true,
                "label": "Workload",
                "multi": true,
                "name": "destination_workload",
                "options": [],
                "query": {
                  "query": "label_values(hubble_flows_processed_total{destination_namespace=\"default\",destination_workload=~\"backend|celery-coordinator|data-extractor|ocr-worker|postgres|redis\"}, destination_workload)",
                  "refId": "Prometheus-destination_workload-Variable-Query"
                },
                "refresh": 1,
                "regex": "",
                "type": "query"
              }
            ]
          },
          "time": {
            "from": "now-5m",
            "to": "now"
          },
          "timepicker": {
            "refresh_intervals": [
              "5s",
              "10s",
              "30s",
              "30s",
              "5m",
              "15m",
              "30m",
              "1h"
            ]
          },
          "timezone": "",
          "title": "Hubble Metrics Dashboard (default)",
          "uid": "hubble-metrics",
          "version": 1
        }
    istio-metrics:
      gnetId: null
      datasource: Prometheus
      json: |
        {
          "annotations": {
            "list": [
              {
                "builtIn": 1,
                "datasource": {
                  "type": "grafana",
                  "uid": "-- Grafana --"
                },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
              }
            ]
          },
          "editable": true,
          "fiscalYearStartMonth": 0,
          "graphTooltip": 0,
          "id": 3,
          "links": [],
          "panels": [
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Requests/s",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 0
              },
              "id": 1,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.2",
              "targets": [
                {
                  "expr": "sum(rate(istio_requests_total{destination_workload!=\"\",destination_workload_namespace=~\"$destination_workload_namespace\"}[30s])) by (destination_workload_namespace, destination_workload)",
                  "legendFormat": "{{destination_workload_namespace}}/{{destination_workload}}",
                  "refId": "A"
                }
              ],
              "title": "Istio Requests per Workload",
              "type": "timeseries"
            },
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Requests/s/pod",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 0
              },
              "id": 2,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.2",
              "targets": [
                {
                  "expr": "sum(rate(istio_requests_total{destination_workload!=\"\",destination_workload_namespace=~\"$destination_workload_namespace\"}[30s])) by (destination_workload)/ (count by (destination_workload) (label_replace(kube_pod_owner{owner_kind=~\"(ReplicaSet|StatefulSet)\", namespace=~\"$destination_workload_namespace\"},\"destination_workload\", \"$1\", \"owner_name\", \"^(.*)-[a-z0-9]+$\")) or vector(1))",
                  "legendFormat": "{{destination_workload_namespace}}/{{destination_workload}}",
                  "refId": "A"
                }
              ],
              "title": "Istio Requests per Pod",
              "type": "timeseries"
            },
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Milliseconds",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "ms"
                },
                "overrides": [
                  {
                    "__systemRef": "hideSeriesFrom",
                    "matcher": {
                      "id": "byNames",
                      "options": {
                        "mode": "exclude",
                        "names": [
                          "default/backend"
                        ],
                        "prefix": "All except:",
                        "readOnly": true
                      }
                    },
                    "properties": [
                      {
                        "id": "custom.hideFrom",
                        "value": {
                          "legend": false,
                          "tooltip": false,
                          "viz": true
                        }
                      }
                    ]
                  }
                ]
              },
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 8
              },
              "id": 3,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.2",
              "targets": [
                {
                  "expr": "histogram_quantile(0.95, sum(rate(istio_request_duration_milliseconds_bucket{destination_workload!=\"\",destination_workload_namespace=~\"$destination_workload_namespace\",le!~\"3600000|1800000|600000.0|300000.0\"}[30s])) by (le, destination_workload_namespace, destination_workload))",
                  "legendFormat": "{{destination_workload_namespace}}/{{destination_workload}}",
                  "refId": "A"
                }
              ],
              "title": "Istio Request Latency (P95)",
              "type": "timeseries"
            },
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Ratio",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "max": 1,
                  "min": 0,
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "percentunit"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 8
              },
              "id": 5,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.2",
              "targets": [
                {
                  "expr": "sum(rate(istio_requests_total{response_code=~\"5..\",destination_workload!=\"\",destination_workload_namespace=~\"$destination_workload_namespace\"}[30s])) by (destination_workload_namespace, destination_workload) / (sum(rate(istio_requests_total{destination_workload!=\"\",destination_workload_namespace=~\"$destination_workload_namespace\"}[30s])) by (destination_workload_namespace, destination_workload) > 0 or vector(0))",
                  "legendFormat": "{{destination_workload_namespace}}/{{destination_workload}}",
                  "refId": "A"
                }
              ],
              "title": "Istio 5xx Error Ratio",
              "type": "timeseries"
            },
            {
              "datasource": "Prometheus",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Milliseconds",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "ms"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 16
              },
              "id": 4,
              "options": {
                "alertThreshold": true,
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.2",
              "targets": [
                {
                  "expr": "sum(rate(istio_request_duration_milliseconds_sum{destination_workload!=\"\", destination_workload_namespace=~\"$destination_workload_namespace\"}[30s])) by (destination_workload_namespace, destination_workload)\n/\nsum(rate(istio_request_duration_milliseconds_count{destination_workload!=\"\", destination_workload_namespace=~\"$destination_workload_namespace\"}[30s])) by (destination_workload_namespace, destination_workload)\n",
                  "legendFormat": "{{destination_workload_namespace}}/{{destination_workload}}",
                  "refId": "A"
                }
              ],
              "title": "Istio Request Latency Average",
              "type": "timeseries"
            }
          ],
          "preload": false,
          "refresh": "5s",
          "schemaVersion": 41,
          "tags": [
            "network",
            "istio"
          ],
          "templating": {
            "list": [
              {
                "current": {
                  "text": "All",
                  "value": [
                    "$__all"
                  ]
                },
                "datasource": "Prometheus",
                "definition": "label_values(istio_requests_total{destination_workload_namespace=\"default\"},destination_workload_namespace)",
                "includeAll": true,
                "label": "Istio Namespace",
                "multi": true,
                "name": "destination_workload_namespace",
                "options": [],
                "query": {
                  "qryType": 1,
                  "query": "label_values(istio_requests_total{destination_workload_namespace=\"default\"},destination_workload_namespace)",
                  "refId": "PrometheusVariableQueryEditor-VariableQuery"
                },
                "refresh": 1,
                "regex": "",
                "type": "query"
              },
              {
                "current": {
                  "text": "All",
                  "value": [
                    "$__all"
                  ]
                },
                "datasource": "Prometheus",
                "definition": "label_values(istio_requests_total{destination_workload_namespace=\"default\", destination_workload!=\"flower\"},destination_workload)",
                "includeAll": true,
                "label": "Istio Workload",
                "multi": true,
                "name": "destination_workload",
                "options": [],
                "query": {
                  "qryType": 1,
                  "query": "label_values(istio_requests_total{destination_workload_namespace=\"default\", destination_workload!=\"flower\"},destination_workload)",
                  "refId": "PrometheusVariableQueryEditor-VariableQuery"
                },
                "refresh": 1,
                "regex": "",
                "type": "query"
              }
            ]
          },
          "time": {
            "from": "now-5m",
            "to": "now"
          },
          "timepicker": {
            "refresh_intervals": [
              "5s",
              "10s",
              "30s",
              "30s",
              "5m",
              "15m",
              "30m",
              "1h"
            ]
          },
          "timezone": "",
          "title": "Istio Metrics Dashboard",
          "uid": "istio-metrics",
          "version": 1
        }
    hpa-load-testing:
      gnetId: null
      datasource: Prometheus
      json: |
        {
          "annotations": {
            "list": [
              {
                "builtIn": 1,
                "datasource": {
                  "type": "grafana",
                  "uid": "-- Grafana --"
                },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
              }
            ]
          },
          "editable": true,
          "fiscalYearStartMonth": 0,
          "graphTooltip": 0,
          "id": 1,
          "links": [],
          "panels": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Seconds",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  }
                },
                "overrides": []
              },
              "gridPos": {
                "h": 14,
                "w": 11,
                "x": 0,
                "y": 0
              },
              "id": 11,
              "options": {
                "legend": {
                  "calcs": [],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "sum(rate(invoice_chain_duration_seconds_sum[30s]))\n/\nsum(rate(invoice_chain_duration_seconds_count[30s]))\n",
                  "legendFormat": "Average Invoice Task Duration",
                  "range": true,
                  "refId": "A"
                }
              ],
              "title": "Average End to End Task Duration",
              "type": "timeseries"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Seconds",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  }
                },
                "overrides": [
                  {
                    "__systemRef": "hideSeriesFrom",
                    "matcher": {
                      "id": "byNames",
                      "options": {
                        "mode": "exclude",
                        "names": [
                          "ocr.perform_ocr"
                        ],
                        "prefix": "All except:",
                        "readOnly": true
                      }
                    },
                    "properties": [
                      {
                        "id": "custom.hideFrom",
                        "value": {
                          "legend": false,
                          "tooltip": false,
                          "viz": true
                        }
                      }
                    ]
                  }
                ]
              },
              "gridPos": {
                "h": 14,
                "w": 11,
                "x": 12,
                "y": 0
              },
              "id": 10,
              "options": {
                "legend": {
                  "calcs": [],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "sum(rate(flower_task_runtime_seconds_sum[30s])) by (task)\n/\nsum(rate(flower_task_runtime_seconds_count[30s])) by (task)\n",
                  "legendFormat": "__auto",
                  "range": true,
                  "refId": "A"
                }
              ],
              "title": "Average Celery Tasks Duration",
              "type": "timeseries"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Replicas",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "__systemRef": "hideSeriesFrom",
                    "matcher": {
                      "id": "byNames",
                      "options": {
                        "mode": "exclude",
                        "names": [
                          "ocr-worker-hpa - Current Replicas",
                          "ocr-worker-hpa - Desired Replicas"
                        ],
                        "prefix": "All except:",
                        "readOnly": true
                      }
                    },
                    "properties": [
                      {
                        "id": "custom.hideFrom",
                        "value": {
                          "legend": false,
                          "tooltip": false,
                          "viz": true
                        }
                      }
                    ]
                  }
                ]
              },
              "gridPos": {
                "h": 14,
                "w": 11,
                "x": 0,
                "y": 14
              },
              "id": 1,
              "options": {
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "kube_horizontalpodautoscaler_status_current_replicas{namespace=\"default\",horizontalpodautoscaler=~\"$hpa\"}",
                  "hide": false,
                  "legendFormat": "{{horizontalpodautoscaler}} - Current Replicas",
                  "range": true,
                  "refId": "B"
                },
                {
                  "editorMode": "code",
                  "expr": "kube_horizontalpodautoscaler_status_desired_replicas{namespace=\"default\",horizontalpodautoscaler=~\"$hpa\"}",
                  "hide": false,
                  "legendFormat": "{{horizontalpodautoscaler}} - Desired Replicas",
                  "range": true,
                  "refId": "C"
                }
              ],
              "title": "Scaling Latency - Desired vs Current Replicas (All Workloads in default)",
              "type": "timeseries"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "CPU Utilization (%)",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "percent"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 14,
                "w": 11,
                "x": 12,
                "y": 14
              },
              "id": 2,
              "options": {
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "sum(\n  label_replace(rate(container_cpu_usage_seconds_total{namespace=\"default\"}[30s]), \"workload\", \"$1\", \"pod\", \"^(.*)-[a-z0-9]+-[a-z0-9]+$\")\n) by (workload)\n/\nsum(\n  label_replace(kube_pod_container_resource_requests{namespace=\"default\", resource=\"cpu\"}, \"workload\", \"$1\", \"pod\", \"^(.*)-[a-z0-9]+-[a-z0-9]+$\")\n) by (workload)\n* 100\n",
                  "hide": false,
                  "legendFormat": "{{workload}}",
                  "range": true,
                  "refId": "A"
                },
                {
                  "editorMode": "code",
                  "expr": "kube_horizontalpodautoscaler_spec_target_metric{namespace=\"default\",horizontalpodautoscaler=~\"$hpa\",metric_name=\"cpu\",metric_target_type=\"utilization\"}",
                  "hide": true,
                  "legendFormat": "{{horizontalpodautoscaler}} - CPU Target (%)",
                  "range": true,
                  "refId": "B"
                }
              ],
              "title": "CPU Utilization (All Workloads in default)",
              "type": "timeseries"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Memory Utilization (%)",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "percent"
                },
                "overrides": [
                  {
                    "__systemRef": "hideSeriesFrom",
                    "matcher": {
                      "id": "byNames",
                      "options": {
                        "mode": "exclude",
                        "names": [
                          "backend",
                          "celery-coordinator",
                          "data-extractor",
                          "flower",
                          "ocr-worker"
                        ],
                        "prefix": "All except:",
                        "readOnly": true
                      }
                    },
                    "properties": [
                      {
                        "id": "custom.hideFrom",
                        "value": {
                          "legend": false,
                          "tooltip": false,
                          "viz": true
                        }
                      }
                    ]
                  }
                ]
              },
              "gridPos": {
                "h": 14,
                "w": 11,
                "x": 0,
                "y": 28
              },
              "id": 3,
              "options": {
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "sum(\n  label_replace(rate(container_memory_usage_bytes{namespace=\"default\"}[30s]), \"workload\", \"$1\", \"pod\", \"^(.*)-[a-z0-9]+-[a-z0-9]+$\")\n) by (workload)\n/\nsum(\n  label_replace(kube_pod_container_resource_requests{namespace=\"default\", resource=\"memory\"}, \"workload\", \"$1\", \"pod\", \"^(.*)-[a-z0-9]+-[a-z0-9]+$\")\n) by (workload)\n* 100\n",
                  "hide": false,
                  "legendFormat": "{{workload}}",
                  "range": true,
                  "refId": "A"
                },
                {
                  "editorMode": "code",
                  "expr": "kube_horizontalpodautoscaler_spec_target_metric{namespace=\"default\",horizontalpodautoscaler=~\"$hpa\",metric_name=\"memory\",metric_target_type=\"utilization\"}",
                  "hide": true,
                  "legendFormat": "{{horizontalpodautoscaler}} - Memory Target (%)",
                  "range": true,
                  "refId": "B"
                }
              ],
              "title": "Memory Utilization (All Workloads in default)",
              "type": "timeseries"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Memory (bytes)",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "bytes"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 14,
                "w": 11,
                "x": 12,
                "y": 28
              },
              "id": 7,
              "options": {
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "# sum(container_memory_usage_bytes{namespace=\"default\"}) by (pod)\nsum(label_replace(rate(container_memory_usage_bytes{namespace=\"default\"}[30s]),\"workload\",\"$1\",\"pod\",\"^(.*)-[a-z0-9]+-[a-z0-9]+$\")) by (workload)\n",
                  "legendFormat": "{{workload}}",
                  "range": true,
                  "refId": "A"
                }
              ],
              "title": "Total Memory Usage (All Workloads in default)",
              "type": "timeseries"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "CPU Cores",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "gridPos": {
                "h": 15,
                "w": 11,
                "x": 0,
                "y": 42
              },
              "id": 6,
              "options": {
                "legend": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": "sum(label_replace(rate(container_cpu_usage_seconds_total{namespace=\"default\"}[30s]),\"workload\",\"$1\",\"pod\",\"^(.*)-[a-z0-9]+-[a-z0-9]+$\")) by (workload)\n",
                  "legendFormat": "{{workload}}",
                  "range": true,
                  "refId": "A"
                }
              ],
              "title": "Total CPU Usage (All Workloads in default)",
              "type": "timeseries"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Used Memory / Requested Memory",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  }
                },
                "overrides": []
              },
              "gridPos": {
                "h": 15,
                "w": 11,
                "x": 12,
                "y": 42
              },
              "id": 5,
              "options": {
                "legend": {
                  "calcs": [],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": " (sum(label_replace(avg_over_time(container_memory_usage_bytes{namespace=\"default\"}[5m]),\"workload\",\"$1\",\"pod\",\"^(.*)-[a-z0-9]+-[a-z0-9]+$\")) by (workload) > 0 or vector(1)) / sum(label_replace(kube_pod_container_resource_requests{resource=\"memory\", namespace=\"default\"},\"workload\",\"$1\",\"pod\",\"^(.*)-[a-z0-9]+-[a-z0-9]+$\")) by (workload)",
                  "legendFormat": "{{workload}} ",
                  "range": true,
                  "refId": "A"
                }
              ],
              "title": "Memory Provisioning Ratio (All Workloads in default)",
              "type": "timeseries"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
              },
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "palette-classic"
                  },
                  "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "Used CPU / Requested CPU",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                      "legend": false,
                      "tooltip": false,
                      "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                      "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    },
                    "thresholdsStyle": {
                      "mode": "off"
                    }
                  },
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green"
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  }
                },
                "overrides": []
              },
              "gridPos": {
                "h": 12,
                "w": 11,
                "x": 0,
                "y": 57
              },
              "id": 4,
              "options": {
                "legend": {
                  "calcs": [],
                  "displayMode": "list",
                  "placement": "bottom",
                  "showLegend": true
                },
                "tooltip": {
                  "hideZeros": false,
                  "mode": "single",
                  "sort": "none"
                }
              },
              "pluginVersion": "12.0.1+security-01",
              "targets": [
                {
                  "editorMode": "code",
                  "expr": " sum(label_replace(rate(container_cpu_usage_seconds_total{namespace=\"default\"}[30s]),\"workload\",\"$1\",\"pod\",\"^(.*)-[a-z0-9]+-[a-z0-9]+$\")) by (workload) / sum(label_replace(kube_pod_container_resource_requests{resource=\"cpu\",namespace=\"default\"},\"workload\",\"$1\",\"pod\",\"^(.*)-[a-z0-9]+-[a-z0-9]+$\")) by (workload)",
                  "legendFormat": "{{workload}} ",
                  "range": true,
                  "refId": "A"
                }
              ],
              "title": "CPU Provisioning Ratio (All Workloads in default)",
              "type": "timeseries"
            }
          ],
          "preload": false,
          "refresh": "auto",
          "schemaVersion": 41,
          "tags": [],
          "templating": {
            "list": [
              {
                "current": {
                  "text": "default",
                  "value": "default"
                },
                "includeAll": false,
                "name": "namespace",
                "options": [],
                "query": "label_values(kube_pod_info, namespace)",
                "refresh": 1,
                "type": "query"
              },
              {
                "allValue": ".*",
                "current": {
                  "text": "All",
                  "value": "$__all"
                },
                "includeAll": true,
                "multi": true,
                "name": "hpa",
                "options": [],
                "query": "label_values(kube_hpa_status_current_replicas{namespace=\"default\"}, horizontalpodautoscaler)",
                "refresh": 1,
                "regex": "",
                "type": "query"
              }
            ]
          },
          "time": {
            "from": "now-5m",
            "to": "now"
          },
          "timepicker": {
            "refresh_intervals": [
              "5s",
              "10s",
              "30s",
              "30s",
              "5m",
              "15m",
              "30m",
              "1h"
            ]
          },
          "timezone": "",
          "title": "HPA Load Testing Dashboard",
          "uid": "66944961-deb9-42de-ad77-6d28ffe9d567",
          "version": 1
        }
service:
  # type: ClusterIP
  type: LoadBalancer
  port: 80

  # renderingCallbackURL: "http://grafana:3000/"
  # serverURL: "http://grafana-image-renderer:8081/render"

persistence:
  enabled: true
  size: 10Gi
  storageClassName: standard

